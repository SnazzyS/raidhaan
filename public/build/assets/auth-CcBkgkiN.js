import{h as k,r as I,b as y,B as a,C as s,l as n}from"./app-DDIZjqGS.js";const v=typeof window<"u"?window.localStorage.getItem(s):null,z=typeof window<"u"?JSON.parse(window.localStorage.getItem(a)??"null"):null,o=I({user:z,token:v,loading:!1,error:null}),r=e=>{o.token=e,typeof window<"u"&&(e?(window.localStorage.setItem(s,e),n.defaults.headers.common.Authorization=`Bearer ${e}`):(window.localStorage.removeItem(s),delete n.defaults.headers.common.Authorization))},i=e=>{o.user=e,typeof window<"u"&&(e?window.localStorage.setItem(a,JSON.stringify(e)):window.localStorage.removeItem(a))},B=()=>{o.token&&(n.defaults.headers.common.Authorization=`Bearer ${o.token}`)};B();const x=async e=>{var l,d,c,u,w,f,g,m,h,p;try{o.loading=!0,o.error=null;const{data:t}=await n.post("/login",e);return r(t.access_token),i(t.user),t}catch(t){const S=((d=(l=t.response)==null?void 0:l.data)==null?void 0:d.message)??((f=(w=(u=(c=t.response)==null?void 0:c.data)==null?void 0:u.errors)==null?void 0:w.email)==null?void 0:f[0])??((p=(h=(m=(g=t.response)==null?void 0:g.data)==null?void 0:m.errors)==null?void 0:h.password)==null?void 0:p[0])??"Unable to sign in with those credentials.";throw o.error=S,t}finally{o.loading=!1}},U=async()=>{try{await n.post("/logout")}catch{}finally{A(),y.visit("/login")}},A=()=>{r(null),i(null)},b=()=>{o.token||y.visit("/login")},K=()=>{const e=k(()=>!!o.token);return{state:o,isAuthenticated:e,login:x,logout:U,setToken:r,setUser:i,clearAuth:A,ensureAuthenticated:b}};export{K as u};
