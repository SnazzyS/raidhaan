import{a as D,r as J,h as K,x as W,o as X,c as a,d as e,e as v,f as u,v as y,s as b,F as c,k as p,t as n,w as Y,l as Z,g as o}from"./app-DDIZjqGS.js";const ee={class:"grid gap-6 lg:grid-cols-2"},te={class:"rounded-2xl border border-slate-200 bg-slate-50/50 p-6"},se={class:"space-y-4"},le=["value"],re={class:"rounded-2xl border border-slate-200 bg-white p-6"},ae={class:"grid gap-4 sm:grid-cols-2"},oe=["value"],ne=["value"],ie={class:"sm:col-span-2"},de=["value"],ue={key:0,class:"sm:col-span-2"},me={class:"rounded-2xl border border-slate-200 bg-white p-6"},ce={class:"space-y-4"},pe={class:"grid gap-4 sm:grid-cols-5 sm:items-center"},be={class:"sm:col-span-3"},fe=["onUpdate:modelValue","disabled"],xe={value:"",disabled:""},ye=["value"],ge=["onUpdate:modelValue"],ve={class:"flex justify-end"},he=["onClick"],we={class:"mt-6 flex flex-col gap-4 border-t border-slate-200 pt-4 sm:flex-row sm:items-center sm:justify-between"},_e={class:"text-right"},ke={class:"text-2xl font-bold text-slate-900"},qe={key:0,class:"rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600"},Oe={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-end"},Ce=["disabled"],Ve={key:0,class:"-ml-1 mr-3 size-4 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Se={__name:"OrderForm",props:{mode:{type:String,default:"create"},initialOrder:{type:Object,default:()=>null},submitting:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit"],setup(m,{emit:I}){var w,_,k,q,O,C,V,U,S,z,N,j;const i=m,M=I,F={phone_number:((_=(w=i.initialOrder)==null?void 0:w.customer)==null?void 0:_.phone_number)??"",address:((q=(k=i.initialOrder)==null?void 0:k.customer)==null?void 0:q.address)??"",city:((C=(O=i.initialOrder)==null?void 0:O.customer)==null?void 0:C.city)??""},B={status:((V=i.initialOrder)==null?void 0:V.status)??"pending",delivery_type:((U=i.initialOrder)==null?void 0:U.delivery_type)??"delivery",payment_method:((S=i.initialOrder)==null?void 0:S.payment_method)??"cash",transfer_reference_number:((z=i.initialOrder)==null?void 0:z.transfer_reference_number)??""},f=D(!1),g=D([]),l=J({...F,...B,items:(j=(N=i.initialOrder)==null?void 0:N.items)!=null&&j.length?i.initialOrder.items.map(r=>{var t;return{item_id:r.id,quantity:((t=r.pivot)==null?void 0:t.quantity)??1}}):[{item_id:"",quantity:1}]}),P=["male","hulhumale phase 1","hulhumale phase 2"],T=[{label:"Pending",value:"pending"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],L=[{label:"Delivery",value:"delivery"},{label:"Pickup",value:"pickup"}],A=[{label:"Cash",value:"cash"},{label:"Card",value:"card"},{label:"Transfer",value:"transfer"}],R=async()=>{f.value=!0;try{const{data:r}=await Z.get("/items");g.value=r??[]}finally{f.value=!1}},h=()=>{l.items.push({item_id:"",quantity:1})},E=r=>{l.items.splice(r,1),l.items.length===0&&h()},H=K(()=>l.items.reduce((r,t)=>{const s=g.value.find(x=>x.id===Number(t.item_id));return r+(s?Number(s.price)*Number(t.quantity??1):0)},0)),Q=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"MVR",minimumFractionDigits:2}).format(r??0),$=()=>({phone_number:l.phone_number,address:l.address,city:l.city,order:{status:l.status,delivery_type:l.delivery_type,payment_method:l.payment_method,transfer_reference_number:l.payment_method==="transfer"?l.transfer_reference_number:null,items:l.items.filter(r=>r.item_id).map(r=>({item_id:Number(r.item_id),quantity:Number(r.quantity??1)}))}}),G=()=>{M("submit",$())};return W(()=>l.payment_method,r=>{r!=="transfer"&&(l.transfer_reference_number="")}),X(async()=>{await R()}),(r,t)=>(o(),a("form",{class:"space-y-8",onSubmit:Y(G,["prevent"])},[e("section",ee,[e("div",te,[t[11]||(t[11]=e("header",{class:"mb-4"},[e("h2",{class:"text-lg font-semibold text-slate-900"},"Customer details"),e("p",{class:"text-sm text-slate-500"}," Capture delivery information for fulfilment and receipts. ")],-1)),e("div",se,[e("div",null,[t[7]||(t[7]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Phone number ",-1)),u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.phone_number=s),type:"tel",required:"",minlength:"7",maxlength:"7",class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10",placeholder:"7-digit number"},null,512),[[y,l.phone_number]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Address ",-1)),u(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.address=s),rows:"3",required:"",class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10",placeholder:"Delivery address"},null,512),[[y,l.address]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," City ",-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.city=s),required:"",class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10 capitalize"},[t[9]||(t[9]=e("option",{value:"",disabled:""},"Select",-1)),(o(),a(c,null,p(P,s=>e("option",{key:s,value:s,class:"capitalize"},n(s),9,le)),64))],512),[[b,l.city]])])])]),e("div",re,[t[16]||(t[16]=e("header",{class:"mb-4"},[e("h2",{class:"text-lg font-semibold text-slate-900"},"Order metadata"),e("p",{class:"text-sm text-slate-500"}," Set fulfilment preferences and payment information. ")],-1)),e("div",ae,[e("div",null,[t[12]||(t[12]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Status ",-1)),u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.status=s),required:"",class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10 capitalize"},[(o(),a(c,null,p(T,s=>e("option",{key:s.value,value:s.value,class:"capitalize"},n(s.label),9,oe)),64))],512),[[b,l.status]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Delivery type ",-1)),u(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.delivery_type=s),required:"",class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10 capitalize"},[(o(),a(c,null,p(L,s=>e("option",{key:s.value,value:s.value,class:"capitalize"},n(s.label),9,ne)),64))],512),[[b,l.delivery_type]])]),e("div",ie,[t[14]||(t[14]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Payment method ",-1)),u(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.payment_method=s),required:"",class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10 capitalize"},[(o(),a(c,null,p(A,s=>e("option",{key:s.value,value:s.value,class:"capitalize"},n(s.label),9,de)),64))],512),[[b,l.payment_method]])]),l.payment_method==="transfer"?(o(),a("div",ue,[t[15]||(t[15]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Transfer reference ",-1)),u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.transfer_reference_number=s),type:"text",required:"",placeholder:"Transfer reference number",class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10"},null,512),[[y,l.transfer_reference_number]])])):v("",!0)])])]),e("section",me,[e("header",{class:"mb-6 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},[t[17]||(t[17]=e("div",null,[e("h2",{class:"text-lg font-semibold text-slate-900"},"Order items"),e("p",{class:"text-sm text-slate-500"}," Add each item and quantity to calculate the total automatically. ")],-1)),e("button",{type:"button",class:"inline-flex items-center justify-center rounded-lg border border-slate-300 px-3 py-2 text-xs font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",onClick:h}," Add item ")]),e("div",ce,[(o(!0),a(c,null,p(l.items,(s,x)=>(o(),a("div",{key:x,class:"rounded-xl border border-slate-200 bg-slate-50/50 p-4"},[e("div",pe,[e("div",be,[t[18]||(t[18]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Item ",-1)),u(e("select",{"onUpdate:modelValue":d=>s.item_id=d,required:"",disabled:f.value,class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10"},[e("option",xe,n(f.value?"Loading items…":"Select menu item"),1),(o(!0),a(c,null,p(g.value,d=>(o(),a("option",{key:d.id,value:d.id},n(d.name)+" — "+n(Number(d.price).toFixed(2))+" MVR ",9,ye))),128))],8,fe),[[b,s.item_id]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Quantity ",-1)),u(e("input",{"onUpdate:modelValue":d=>s.quantity=d,type:"number",min:"1",class:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10"},null,8,ge),[[y,s.quantity,void 0,{number:!0}]])]),e("div",ve,[e("button",{type:"button",class:"inline-flex items-center justify-center rounded-lg border border-slate-300 px-3 py-2 text-xs font-semibold text-slate-500 transition hover:border-rose-200 hover:text-rose-600",onClick:d=>E(x)}," Remove ",8,he)])])]))),128))]),e("footer",we,[t[21]||(t[21]=e("p",{class:"text-sm text-slate-500"}," Items must exist in the items catalogue before they can be added to an order. ",-1)),e("div",_e,[t[20]||(t[20]=e("p",{class:"text-xs uppercase tracking-wide text-slate-500"},"Estimated total",-1)),e("p",ke,n(Q(H.value)),1)])])]),m.error?(o(),a("div",qe,n(m.error),1)):v("",!0),e("div",Oe,[e("button",{type:"submit",class:"inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-slate-800 disabled:opacity-60",disabled:m.submitting},[m.submitting?(o(),a("svg",Ve,[...t[22]||(t[22]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"},null,-1)])])):v("",!0),e("span",null,n(m.submitting?"Saving…":m.mode==="create"?"Create order":"Update order"),1)],8,Ce)])],32))}};export{Se as _};
