import{a as h,r as z,h as E,o as B,i as R,j as w,d as e,p as O,u as T,q as V,m as k,c as i,e as I,w as K,f as p,y as L,v as C,g as d,F as m,k as x,t as o,s as M,n as G,l as g}from"./app-DDIZjqGS.js";import{_ as H}from"./AppLayout-DcxM-feb.js";import{u as J}from"./auth-CcBkgkiN.js";const Q={class:"space-y-6"},W={class:"flex flex-col gap-4 border-b border-slate-200 pb-4 sm:flex-row sm:items-center sm:justify-between"},X={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},Y={class:"flex flex-col gap-2"},Z={class:"flex flex-col gap-2"},ee=["value"],te={class:"flex flex-col gap-2"},se=["value"],le={class:"flex flex-col gap-2"},ae=["value"],oe={class:"flex flex-col gap-2 md:col-span-2"},re={class:"grid gap-3 sm:grid-cols-2"},ne={class:"flex items-end gap-3 md:col-span-2 xl:col-span-4"},de={key:0,class:"mt-6 rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600"},ie={class:"mt-6 overflow-x-auto"},ue={class:"min-w-full divide-y divide-slate-200 text-left text-sm text-slate-600"},ce={class:"divide-y divide-slate-100"},pe={key:1,class:"bg-slate-50/70"},me={class:"px-4 py-4"},xe={class:"font-semibold text-slate-900"},fe={class:"text-xs text-slate-500"},ye={class:"px-4 py-4"},be={class:"font-medium text-slate-900"},ve={class:"text-xs text-slate-500 capitalize"},he={class:"px-4 py-4"},ge={class:"space-y-1 text-xs text-slate-500"},_e={class:"text-slate-900"},we={class:"px-4 py-4 capitalize"},ke={class:"px-4 py-4 capitalize"},Ce={class:"px-4 py-4 font-semibold text-slate-900"},Me={class:"px-4 py-4"},De={class:"px-4 py-4"},Oe={class:"flex flex-wrap items-center gap-2"},Te=["href"],Ve=["disabled","onClick"],$e=["disabled","onClick"],Ae=["onClick"],Ne={__name:"Index",setup(Se){const $=J(),f=h([]),_=h(!1),c=h(""),v=h(null),a=z({search:"",status:"all",deliveryType:"all",paymentMethod:"all",from:"",to:""}),A=[{value:"all",label:"All statuses"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],S=[{value:"all",label:"All delivery types"},{value:"delivery",label:"Delivery"},{value:"pickup",label:"Pickup"}],q=[{value:"all",label:"All payment methods"},{value:"cash",label:"Cash"},{value:"card",label:"Card"},{value:"transfer",label:"Transfer"}],F=E(()=>{const l={};return a.search&&(l.search=a.search),a.status!=="all"&&(l["filter[status]"]=a.status),a.deliveryType!=="all"&&(l["filter[delivery_type]"]=a.deliveryType),a.paymentMethod!=="all"&&(l["filter[payment_method]"]=a.paymentMethod),a.from&&a.to&&(l.from=a.from,l.to=a.to),l}),P=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"MVR",minimumFractionDigits:2}).format(l??0),N=l=>new Intl.DateTimeFormat("en",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}).format(new Date(l)),y=async()=>{var l,s;_.value=!0,c.value="";try{const{data:t}=await g.get("/orders",{params:F.value});f.value=t??[]}catch(t){c.value=((s=(l=t.response)==null?void 0:l.data)==null?void 0:s.message)??"Failed to fetch orders. Please try again."}finally{_.value=!1}},U=(l,s=null)=>{var t,r,u;return{phone_number:(t=l.customer)==null?void 0:t.phone_number,address:(r=l.customer)==null?void 0:r.address,city:(u=l.customer)==null?void 0:u.city,order:{status:s??l.status,delivery_type:l.delivery_type,payment_method:l.payment_method,transfer_reference_number:l.transfer_reference_number,items:(l.items??[]).map(n=>{var b;return{item_id:n.id,quantity:((b=n.pivot)==null?void 0:b.quantity)??1}})}}},D=async(l,s)=>{var t,r;if(["pending","completed","cancelled"].includes(s)){v.value=l;try{const{data:u}=await g.get(`/orders/${l}`),n=U(u,s);await g.put(`/orders/${l}`,n),await y()}catch(u){c.value=((r=(t=u.response)==null?void 0:t.data)==null?void 0:r.message)??"Failed to update order. Please retry after reloading the page."}finally{v.value=null}}},j=async l=>{var s,t;if(window.confirm("Are you sure you want to delete this order?"))try{await g.delete(`/orders/${l}`),f.value=f.value.filter(r=>r.id!==l)}catch(r){c.value=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)??"Failed to delete the order."}};return B(async()=>{$.ensureAuthenticated(),await y()}),(l,s)=>(d(),R(H,null,{default:w(()=>[e("section",Q,[e("header",W,[s[8]||(s[8]=e("div",null,[e("h1",{class:"text-2xl font-semibold text-slate-900"},"Orders"),e("p",{class:"text-sm text-slate-500"}," Manage new orders, update fulfilment status, and access customer information. ")],-1)),O(T(V),{href:"/orders/create",class:"inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-slate-800"},{default:w(()=>[...s[7]||(s[7]=[k(" Create order ",-1)])]),_:1})]),e("section",X,[e("form",{class:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",onSubmit:K(y,["prevent"])},[e("div",Y,[s[9]||(s[9]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Search",-1)),p(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>a.search=t),type:"search",placeholder:"Order #, customer phone, city…",class:"rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10",onKeyup:L(y,["enter"])},null,544),[[C,a.search,void 0,{trim:!0}]])]),e("div",Z,[s[10]||(s[10]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Status",-1)),p(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>a.status=t),class:"rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10"},[(d(),i(m,null,x(A,t=>e("option",{key:t.value,value:t.value},o(t.label),9,ee)),64))],512),[[M,a.status]])]),e("div",te,[s[11]||(s[11]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Delivery",-1)),p(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>a.deliveryType=t),class:"rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10"},[(d(),i(m,null,x(S,t=>e("option",{key:t.value,value:t.value},o(t.label),9,se)),64))],512),[[M,a.deliveryType]])]),e("div",le,[s[12]||(s[12]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Payment",-1)),p(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>a.paymentMethod=t),class:"rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10"},[(d(),i(m,null,x(q,t=>e("option",{key:t.value,value:t.value},o(t.label),9,ae)),64))],512),[[M,a.paymentMethod]])]),e("div",oe,[s[13]||(s[13]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Date range",-1)),e("div",re,[p(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>a.from=t),type:"date",class:"rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10"},null,512),[[C,a.from]]),p(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>a.to=t),type:"date",class:"rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10"},null,512),[[C,a.to]])])]),e("div",ne,[s[14]||(s[14]=e("button",{type:"submit",class:"inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-slate-800"}," Apply filters ",-1)),e("button",{type:"button",class:"inline-flex items-center justify-center rounded-lg border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",onClick:s[6]||(s[6]=t=>{a.search="",a.status="all",a.deliveryType="all",a.paymentMethod="all",a.from="",a.to="",y()})}," Reset ")])],32),c.value?(d(),i("div",de,o(c.value),1)):I("",!0),e("div",ie,[e("table",ue,[s[18]||(s[18]=e("thead",null,[e("tr",{class:"text-xs uppercase tracking-wide text-slate-500"},[e("th",{class:"px-4 py-3 font-medium"},"Order"),e("th",{class:"px-4 py-3 font-medium"},"Customer"),e("th",{class:"px-4 py-3 font-medium"},"Items"),e("th",{class:"px-4 py-3 font-medium"},"Delivery"),e("th",{class:"px-4 py-3 font-medium"},"Payment"),e("th",{class:"px-4 py-3 font-medium"},"Total"),e("th",{class:"px-4 py-3 font-medium"},"Status"),e("th",{class:"px-4 py-3 font-medium"},"Actions")])],-1)),e("tbody",ce,[_.value?(d(),i(m,{key:0},x(5,t=>e("tr",{key:t,class:"animate-pulse bg-slate-50/60"},[...s[15]||(s[15]=[e("td",{colspan:"8",class:"px-4 py-3"},[e("div",{class:"h-4 w-full rounded bg-slate-200"})],-1)])])),64)):f.value.length===0?(d(),i("tr",pe,[...s[16]||(s[16]=[e("td",{colspan:"8",class:"px-4 py-6 text-center text-sm text-slate-500"}," No orders match the selected filters. ",-1)])])):(d(!0),i(m,{key:2},x(f.value,t=>{var r,u;return d(),i("tr",{key:t.id,class:"transition hover:bg-slate-50"},[e("td",me,[e("div",xe,o(t.order_number),1),e("div",fe,o(N(t.created_at)),1)]),e("td",ye,[e("div",be,o(((r=t.customer)==null?void 0:r.phone_number)??"N/A"),1),e("div",ve,o(((u=t.customer)==null?void 0:u.city)??"—"),1)]),e("td",he,[e("ul",ge,[(d(!0),i(m,null,x(t.items,n=>{var b;return d(),i("li",{key:n.id},[e("span",_e,o(n.name),1),k(" × "+o(((b=n.pivot)==null?void 0:b.quantity)??1),1)])}),128))])]),e("td",we,o(t.delivery_type),1),e("td",ke,o(t.payment_method),1),e("td",Ce,o(P(t.total_amount)),1),e("td",Me,[e("span",{class:G(["inline-flex rounded-full px-3 py-1 text-xs font-semibold capitalize",{"bg-amber-100 text-amber-700":t.status==="pending","bg-emerald-100 text-emerald-700":t.status==="completed","bg-rose-100 text-rose-700":t.status==="cancelled"}])},o(t.status),3)]),e("td",De,[e("div",Oe,[O(T(V),{href:`/orders/${t.id}/edit`,class:"rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-900"},{default:w(()=>[...s[17]||(s[17]=[k(" Edit ",-1)])]),_:1},8,["href"]),e("a",{href:`/api/orders/${t.id}/receipt`,target:"_blank",class:"rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-900"}," Receipt ",8,Te),e("button",{type:"button",class:"rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-900 disabled:opacity-60",disabled:v.value===t.id,onClick:n=>D(t.id,"completed")}," Mark complete ",8,Ve),e("button",{type:"button",class:"rounded-lg border border-rose-200 px-3 py-1.5 text-xs font-semibold text-rose-600 transition hover:border-rose-300 hover:text-rose-700 disabled:opacity-60",disabled:v.value===t.id,onClick:n=>D(t.id,"cancelled")}," Cancel ",8,$e),e("button",{type:"button",class:"rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-500 transition hover:border-rose-200 hover:text-rose-600",onClick:n=>j(t.id)}," Delete ",8,Ae)])])])}),128))])])])])])]),_:1}))}};export{Ne as default};
